<!DOCTYPE html><html><head><title>scalambda: Create an API</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Carpe Data" /><meta name="description" content="Toolkit for building/deploying Lambda Functions with SBT" /><meta name="og:image" content="/scalambda/img/poster.png" /><meta name="image" property="og:image" content="/scalambda/img/poster.png" /><meta name="og:title" content="scalambda: Create an API" /><meta name="title" property="og:title" content="scalambda: Create an API" /><meta name="og:site_name" content="scalambda" /><meta name="og:url" content="https://carpe.github.io/scalambda/" /><meta name="og:type" content="website" /><meta name="og:description" content="Toolkit for building/deploying Lambda Functions with SBT" /><link rel="icon" type="image/png" href="/scalambda/img/favicon.png" /><meta name="twitter:title" content="scalambda: Create an API" /><meta name="twitter:image" content="/scalambda/img/poster.png" /><meta name="twitter:description" content="Toolkit for building/deploying Lambda Functions with SBT" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/scalambda/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scalambda/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scalambda/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scalambda/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scalambda/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scalambda/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scalambda/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scalambda/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scalambda/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scalambda/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scalambda/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scalambda/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scalambda/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scalambda/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scalambda/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scalambda/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scalambda/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scalambda/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scalambda/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scalambda/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scalambda/highlight/styles/vs.css" /><link rel="stylesheet" href="/scalambda/css/light-style.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-85042842-3' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/scalambda/" class="brand"><div class="brand-wrapper"></div><span>scalambda</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/scalambda/docs/" title="Getting Started" class="">Getting Started</a></div> <div class="sidebar-nav-item  "><a href="/scalambda/docs/configuration" title="Configuring Functions" class="">Configuring Functions</a></div> <div class="sidebar-nav-item  "><a href="/scalambda/docs/writing-functions" title="Writing Functions" class="">Writing Functions</a></div> <div class="sidebar-nav-item  "><a href="/scalambda/docs/deploying-functions" title="Deploying Functions" class="">Deploying Functions</a></div> <div class="sidebar-nav-item  open"><button type="button" title="Api Gateway" class="button drop-nested">Api Gateway</button><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/scalambda/docs/api/create-api" title="Create an API" class="active">Create an API</a> <a href="/scalambda/docs/api/deploy-api" title="Deploy an API" class="">Deploy an API</a></div></div> <div class="sidebar-nav-item  "><a href="/scalambda/docs/thegraaaaal/" title="Using Graal Native" class="">Using Graal Native</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/carpe/scalambda" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/carpe/scalambda" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="carpe" data-github-repo="scalambda"><div class="content-wrapper"><section><h2 id="defining-your-api">Defining your API</h2>

<p>Here is how you might define the classic Petstore API example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// build.sbt</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="nv">petstore</span> <span class="k">=</span> <span class="n">project</span>
  <span class="o">.</span><span class="py">enablePlugins</span><span class="o">(</span><span class="nc">ScalambdaPlugin</span><span class="o">)</span>
  <span class="o">.</span><span class="py">settings</span><span class="o">({</span>
    <span class="c1">// save the lambda function to a value so you can re-use it across multiple endpoints </span>
    <span class="k">lazy</span> <span class="k">val</span> <span class="nv">petsHandler</span> <span class="k">=</span> <span class="nc">Function</span><span class="o">(</span>
      <span class="n">functionClasspath</span> <span class="k">=</span> <span class="o">???</span> <span class="c1">// example: "io.carpe.example.CreatePet"</span>
    <span class="o">)</span>
    
    <span class="c1">// the apiGatewayDefinition function allows us name our api and map the lambda function above to http endpoints</span>
    <span class="nf">apiGatewayDefinition</span><span class="o">(</span><span class="n">apiGatewayInstanceName</span> <span class="k">=</span> <span class="s">"petstore-api-${terraform.workspace}"</span><span class="o">)(</span>
      <span class="c1">// This sends all POST requests to "&lt;my api domain&gt;/pets" to our lambda function</span>
      <span class="nc">POST</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span><span class="o">,</span>
      <span class="c1">// This sends all GET requests to "&lt;my api domain&gt;/pets" to our lambda function</span>
      <span class="nc">GET</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span><span class="o">,</span>
      <span class="c1">// This sends all GET requests to "&lt;my api domain&gt;/pets/&lt;some pet id&gt;" to our lambda function</span>
      <span class="c1">// (it also makes "id" available as a path parameter, inside the pathParameters field on the request)</span>
      <span class="nc">GET</span><span class="o">(</span><span class="s">"/pets/{id}"</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span>
    <span class="o">)</span>
  <span class="o">})</span>
</code></pre></div></div>

<p>As you can see in the above example, we can map the same function to multiple endpoints. This helps keep cold start times down by allowing your functions to be re-used more frequently. You can just as easily define a lambda function for each endpoint if you’d prefer.</p>

<h2 id="handling-authorization">Handling Authorization</h2>

<p>There are two ways to secure your Api Gateways. The high-level steps for adding both to your API are the same:</p>

<ol>
  <li>Define the desired <code class="language-plaintext highlighter-rouge">Auth</code> in SBT</li>
  <li>Run <code class="language-plaintext highlighter-rouge">scalambdaTerraform</code> to generate terraform (do not deploy anything just yet)</li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform validate</code> to make sure you’ve met all the requirements for your chosen <code class="language-plaintext highlighter-rouge">Auth</code></li>
</ol>

<h4 id="auth-via-api-key">Auth via Api-Key</h4>

<p><strong>Easy, but not flexible/secure enough for most use-cases</strong></p>

<p><code class="language-plaintext highlighter-rouge">Auth.ApiKey</code> will require your users to provide an Api Key when making requests. By default, this Api Key is passed in via the <code class="language-plaintext highlighter-rouge">X-Api-Key</code> header.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// build.sbt</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="nv">petstore</span> <span class="k">=</span> <span class="n">project</span>
  <span class="o">.</span><span class="py">enablePlugins</span><span class="o">(</span><span class="nc">ScalambdaPlugin</span><span class="o">)</span>
  <span class="o">.</span><span class="py">settings</span><span class="o">({</span>
    <span class="k">val</span> <span class="nv">petsHandler</span> <span class="k">=</span> <span class="o">???</span>
    <span class="k">val</span> <span class="nv">loginHandler</span> <span class="k">=</span> <span class="o">???</span>

    <span class="c1">// this auth config will be implicitly applied to the POST and GET methods below.</span>
    <span class="c1">// Auth.ApiKey will set the endpoint to require an Api Key via Api Gateway's Api Key service (be warned that using</span>
    <span class="c1">// only Api Key authorization is not recommended by AWS).</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="nv">apiGatewayApiKeyAuthorizer</span><span class="k">:</span> <span class="kt">Auth</span> <span class="o">=</span> <span class="nv">Auth</span><span class="o">.</span><span class="py">ApiKey</span>
    
    <span class="nf">apiGatewayDefinition</span><span class="o">(</span><span class="n">apiGatewayInstanceName</span> <span class="k">=</span> <span class="s">"petstore-api-${terraform.workspace}"</span><span class="o">)(</span>
      <span class="nc">POST</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span><span class="o">,</span>
      <span class="nc">GET</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span>
      <span class="c1">// allow all users to hit the login endpoint by explicitly passing `Auth.AllowAll`</span>
      <span class="nc">POST</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)(</span><span class="nv">Auth</span><span class="o">.</span><span class="py">AllowAll</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">loginHandler</span>
    <span class="o">)</span>
  <span class="o">})</span>
</code></pre></div></div>

<h4 id="auth-via-lambda-authorizer">Auth via Lambda Authorizer</h4>

<p><strong>Difficult, but will work for nearly any use-case</strong></p>

<p>If you need something more flexible than Api Keys OR you want to inject and cache data within each user’s session, you probably want to use Custom Lambda Authorizers. Before you jump in straight in though, you’ll probably want to <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html#api-gateway-lambda-authorizer-flow">read up on Custom Authorizers in the AWS Docs</a>.</p>

<p>Finished reading the documentation above? Good. So, according to AWS, there are two different authorizer types (<code class="language-plaintext highlighter-rouge">REQUEST</code> or <code class="language-plaintext highlighter-rouge">TOKEN</code>). The majority of APIs will use Authorizers of type <code class="language-plaintext highlighter-rouge">TOKEN</code>, but here’s how to define both of them in SBT:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// build.sbt</span>

<span class="c1">// Lambda Authorizer of type TOKEN</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">myTokenAuthorizer</span><span class="k">:</span> <span class="kt">Auth</span> <span class="o">=</span> <span class="nv">Auth</span><span class="o">.</span><span class="py">TokenAuthorizer</span><span class="o">(</span>
  <span class="c1">// this name can be anything you'd like. It will be ysed to create variables in the terraform module that is outputted by</span>
  <span class="c1">// the `scalambdaTerraform` task.</span>
  <span class="n">tfVariableName</span> <span class="k">=</span> <span class="s">"my_token_authorizer"</span>
<span class="o">)</span>

<span class="c1">// Lambda Authorizer of type REQUEST</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">myRequestAuthorizer</span><span class="k">:</span> <span class="kt">Auth</span> <span class="o">=</span> <span class="nv">Auth</span><span class="o">.</span><span class="py">RequestAuthorizer</span><span class="o">(</span>
  <span class="c1">// this name can be anything you'd like. It will be used to create variables in the terraform module that is outputted by</span>
  <span class="c1">// the `scalambdaTerraform` task.</span>
  <span class="n">tfVariableName</span> <span class="k">=</span> <span class="s">"my_request_authorizer"</span><span class="o">,</span> 
  <span class="n">identitySources</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"method.request.header.X-Api-Key"</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>

<p>Once you’ve defined these authorizers in SBT, you’ll likely want to run <code class="language-plaintext highlighter-rouge">scalambdaTerraform</code> to generate terraform variables that you can use to connect your Api to the Authorizers.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span> <span class="s2">"my_api"</span> <span class="p">{</span>
  <span class="c1">// path to terraform generated by `scalambdaTerraform` (your actual path may differ from this one)</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./target/terraform"</span> 

  <span class="c1">// standard input variables for the pets handler lambda we created in the last example</span>
  <span class="nx">pets_handler_lambda_role_arn</span> <span class="p">=</span> <span class="s2">"&lt;arn:aws:iam:0123456789:role/for-the-pets-handler-function&gt;"</span>

  <span class="c1">// These next two variables are generated if you defined either an Auth.TokenAuthorizer or Auth.RequestAuthorizer</span>
  <span class="nx">authorizer_role</span> <span class="p">=</span> <span class="s2">"&lt;arn:aws:iam:0123456789:role/for-the-authorizer&gt;"</span> <span class="c1">// role for invoking the authorizer lambda</span>
  <span class="nx">authorizer_uri</span> <span class="p">=</span> <span class="s2">"arn:aws:apigateway:us-west-2:lambda:path/2015-03-31/functions/YourCustomAuthorizerFunction/invocations"</span> <span class="c1">// invocation endpoint for the authorizer lambda function  </span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="auth-via-both">Auth via Both</h4>

<p>Want to take advantage of AWS Usage Plans and Api Keys, but also need to inject in some custom session data? You can use <code class="language-plaintext highlighter-rouge">Auth.Multiple</code> to combine as many different authorization methods as you’d like.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// this type of Auth config combines multiple different authorization methods. It will require both of the authorization</span>
<span class="c1">// methods to "pass" before allowing the Lambda function to be invoked.</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">requireApiKeyAndRequestAuthorizer</span><span class="k">:</span> <span class="kt">Auth</span> <span class="o">=</span> <span class="nv">Auth</span><span class="o">.</span><span class="py">Multiple</span><span class="o">(</span>
  <span class="c1">// request authorizer that fetches data from the X-Api-Key header (the same one that the ApiKey looks at)</span>
  <span class="nv">Auth</span><span class="o">.</span><span class="py">RequestAuthorizer</span><span class="o">(</span><span class="s">"authorizer"</span><span class="o">,</span> <span class="n">identitySources</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"method.request.header.X-Api-Key"</span><span class="o">)),</span>
  <span class="nv">Auth</span><span class="o">.</span><span class="py">ApiKey</span>
<span class="o">)</span>
</code></pre></div></div>

<h2 id="handling-cors">Handling CORS</h2>

<p><strong>Scalambda automatically adds OPTIONS request handling to each endpoint in your API</strong>. If you prefer to handle CORS yourself, you have a few options.</p>

<h4 id="disable-scalambdas-automatic-handling-of-cors">Disable Scalambda’s automatic handling of CORS</h4>

<p>Here is an example of how you can disable OPTIONS request handling for the <code class="language-plaintext highlighter-rouge">/pets</code> route:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">lazy</span> <span class="k">val</span> <span class="nv">petstore</span> <span class="k">=</span> <span class="n">project</span>
  <span class="o">.</span><span class="py">enablePlugins</span><span class="o">(</span><span class="nc">ScalambdaPlugin</span><span class="o">)</span>
  <span class="o">.</span><span class="py">settings</span><span class="o">({</span>
    <span class="k">val</span> <span class="nv">petsHandler</span> <span class="k">=</span> <span class="o">???</span>
    
    <span class="nf">apiGatewayDefinition</span><span class="o">(</span><span class="n">apiGatewayInstanceName</span> <span class="k">=</span> <span class="s">"petstore-api-${terraform.workspace}"</span><span class="o">)(</span>
      <span class="c1">// setting to CORS.AllowNone will prevent scalambda from adding a default OPTIONS request handler for "/pets"</span>
      <span class="nc">POST</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">,</span> <span class="n">cors</span> <span class="k">=</span> <span class="nv">CORS</span><span class="o">.</span><span class="py">AllowNone</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span><span class="o">,</span>
      <span class="nc">GET</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">,</span> <span class="n">cors</span> <span class="k">=</span> <span class="nv">CORS</span><span class="o">.</span><span class="py">AllowNone</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span>
    <span class="o">)</span>
  <span class="o">})</span>
</code></pre></div></div>

<h4 id="create-a-lambda-to-handle-options-requests">Create a Lambda to handle OPTIONS requests</h4>

<p>Here is an example of how you use your own Lambda to handle OPTIONS requests for the <code class="language-plaintext highlighter-rouge">/pets</code> route:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">lazy</span> <span class="k">val</span> <span class="nv">petstore</span> <span class="k">=</span> <span class="n">project</span>
  <span class="o">.</span><span class="py">enablePlugins</span><span class="o">(</span><span class="nc">ScalambdaPlugin</span><span class="o">)</span>
  <span class="o">.</span><span class="py">settings</span><span class="o">({</span>
    <span class="k">val</span> <span class="nv">petsHandler</span> <span class="k">=</span> <span class="o">???</span>
    <span class="k">val</span> <span class="nv">optionsHandler</span> <span class="k">=</span> <span class="o">???</span>
    
    <span class="nf">apiGatewayDefinition</span><span class="o">(</span><span class="n">apiGatewayInstanceName</span> <span class="k">=</span> <span class="s">"petstore-api-${terraform.workspace}"</span><span class="o">)(</span>
      <span class="nc">POST</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span><span class="o">,</span>
      <span class="nc">GET</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">petsHandler</span>
      <span class="c1">// this OPTIONS request handler will override the one scalambda provides by default for "/pets" </span>
      <span class="nc">OPTIONS</span><span class="o">(</span><span class="s">"/pets"</span><span class="o">)(</span><span class="nv">Auth</span><span class="o">.</span><span class="py">AllowAll</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">optionsHandler</span>
    <span class="o">)</span>
  <span class="o">})</span>
</code></pre></div></div>

<h2 id="defining-lambdas-for-apigateway">Defining Lambdas for ApiGateway</h2>

<p>When Api Gateway receives a request, it will invoke the configured Lambda Function with what AWS calls an “Api Gateway Proxy Request”. They also expect your function to provide a response in the form of an “Api Gateway Proxy Response”.</p>

<p>Scalambda provides both of these as traits that you can use in your Lambda Functions like so:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">io.carpe.example</span>

<span class="k">import</span> <span class="nn">com.amazonaws.services.lambda.runtime.Context</span>
<span class="k">import</span> <span class="nn">io.carpe.scalambda.Scalambda</span>
<span class="k">import</span> <span class="nn">io.carpe.scalambda.request.APIGatewayProxyRequest</span>
<span class="k">import</span> <span class="nn">io.carpe.scalambda.response.</span><span class="o">{</span><span class="nc">APIGatewayProxyResponse</span><span class="o">,</span> <span class="nc">ApiError</span><span class="o">}</span>


<span class="k">class</span> <span class="nc">Greeter</span> <span class="k">extends</span> <span class="nc">Scalambda</span><span class="o">[</span><span class="kt">APIGatewayProxyRequest</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>, <span class="kt">APIGatewayProxyResponse</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="o">{</span>

  <span class="cm">/**
   * Accept a request that provides someone's name in a JSON body.
   *
   * Response with a greeting for that given person.
   *
   * @param input from api gateway that represents the request
   * @param context lambda request context
   * @return
   */</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">handleRequest</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">APIGatewayProxyRequest</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">context</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">APIGatewayProxyResponse</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">greetingResponse</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
      <span class="c1">// attempt to get the provided name from the input</span>
      <span class="n">inputName</span> <span class="k">&lt;-</span> <span class="nv">input</span><span class="o">.</span><span class="py">body</span>

      <span class="c1">// use it to create a greeting</span>
      <span class="n">greeting</span> <span class="k">=</span> <span class="n">s</span><span class="s">"Hello, ${inputName}!"</span>
    <span class="o">}</span> <span class="k">yield</span> <span class="o">{</span>
      <span class="c1">// place the greeting inside a response object, along with any headers that you'd like</span>
      <span class="c1">// to supply. </span>
      <span class="nv">APIGatewayProxyResponse</span><span class="o">.</span><span class="py">WithBody</span><span class="o">(</span>
        <span class="n">statusCode</span> <span class="k">=</span> <span class="mi">200</span><span class="o">,</span>
        <span class="n">headers</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
          <span class="s">"content-type"</span> <span class="o">-&gt;</span> <span class="s">"application/json"</span>
        <span class="o">),</span>
        <span class="n">body</span> <span class="k">=</span> <span class="n">greeting</span>
      <span class="o">)</span>
    <span class="o">}</span>

    <span class="c1">// return the result, or an error to Api Gateway</span>
    <span class="nv">greetingResponse</span><span class="o">.</span><span class="py">getOrElse</span><span class="o">({</span>
      <span class="nv">APIGatewayProxyResponse</span><span class="o">.</span><span class="py">WithError</span><span class="o">(</span>
        <span class="c1">// ApiError has a default encoder that will be used to inject errors into the </span>
        <span class="c1">// response body as json. You can override this encoder if you'd like, it is an implicit</span>
        <span class="c1">// parameter for the APIGatewayProxyResponse.WithError's constructor </span>
        <span class="n">error</span> <span class="k">=</span> <span class="nv">ApiError</span><span class="o">.</span><span class="py">InputError</span><span class="o">(</span><span class="s">"No input was provided"</span><span class="o">),</span>      
        <span class="n">headers</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
          <span class="s">"content-type"</span> <span class="o">-&gt;</span> <span class="s">"application/json"</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">})</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>As you can see, there really isn’t too much of a difference between a Lambda Function that serves requests from Api Gateway and one that does not. The only thing that changes is the input to your Function.</p>
</section></div></div></div></div><script src="/scalambda/highlight/highlight.pack.js"></script><script src="/scalambda/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/scalambda/js/search.js"></script><script src="/scalambda/js/docs.js"></script></body></html>