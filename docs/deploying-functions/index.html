<!DOCTYPE html><html><head><title>scalambda: Deploying Functions</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Carpe Data" /><meta name="description" content="Toolkit for building/deploying Lambda Functions with SBT" /><meta name="og:image" content="/scalambda/img/poster.png" /><meta name="image" property="og:image" content="/scalambda/img/poster.png" /><meta name="og:title" content="scalambda: Deploying Functions" /><meta name="title" property="og:title" content="scalambda: Deploying Functions" /><meta name="og:site_name" content="scalambda" /><meta name="og:url" content="https://carpe.github.io/scalambda/" /><meta name="og:type" content="website" /><meta name="og:description" content="Toolkit for building/deploying Lambda Functions with SBT" /><link rel="icon" type="image/png" href="/scalambda/img/favicon.png" /><meta name="twitter:title" content="scalambda: Deploying Functions" /><meta name="twitter:image" content="/scalambda/img/poster.png" /><meta name="twitter:description" content="Toolkit for building/deploying Lambda Functions with SBT" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/scalambda/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scalambda/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scalambda/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scalambda/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scalambda/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scalambda/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scalambda/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scalambda/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scalambda/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scalambda/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scalambda/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scalambda/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scalambda/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scalambda/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scalambda/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scalambda/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scalambda/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scalambda/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scalambda/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scalambda/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scalambda/highlight/styles/vs.css" /><link rel="stylesheet" href="/scalambda/css/light-style.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-85042842-3' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/scalambda/" class="brand"><div class="brand-wrapper"></div><span>scalambda</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/scalambda/docs/" title="Getting Started" class="">Getting Started</a></div> <div class="sidebar-nav-item  "><a href="/scalambda/docs/configuration" title="Configuring Functions" class="">Configuring Functions</a></div> <div class="sidebar-nav-item  "><a href="/scalambda/docs/writing-functions" title="Writing Functions" class="">Writing Functions</a></div> <div class="sidebar-nav-item active "><a href="/scalambda/docs/deploying-functions" title="Deploying Functions" class="active">Deploying Functions</a></div> <div class="sidebar-nav-item  "><button type="button" title="Api Gateway" class="button drop-nested">Api Gateway</button><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/scalambda/docs/api/create-api" title="Create an API" class="">Create an API</a> <a href="/scalambda/docs/api/deploy-api" title="Deploy an API" class="">Deploy an API</a></div></div> <div class="sidebar-nav-item  "><a href="/scalambda/docs/thegraaaaal/" title="Using Graal Native" class="">Using Graal Native</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/carpe/scalambda" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/carpe/scalambda" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="carpe" data-github-repo="scalambda"><div class="content-wrapper"><section><h2 id="deploying-functions">Deploying Functions</h2>

<p>Assuming you already have an <a href="https://aws.amazon.com/">AWS account</a> and have installed <a href="https://www.scala-sbt.org/1.x/docs/Setup.html">sbt</a> and <a href="https://learn.hashicorp.com/terraform/getting-started/install.html">Terraform</a>, you can have a function deployed in less than 5 minutes (for real, we did it live during a few internal presentations to prove it).</p>

<p><strong>Run the <code class="language-plaintext highlighter-rouge">scalambdaTerraform</code> SBT task.</strong> This will generate a Terraform module (by default it will be placed inside your project’s <code class="language-plaintext highlighter-rouge">target/</code> folder). You can then use this module to deploy your project. Super easy, right?</p>

<p>You can do pretty much anything you want with the Terraform that Scalambda generates. You could package it and hand it off to your dev-ops team, throw it in a Docker image, whatever you’d like!</p>

<p><strong>At a high-level, the deploy process for almost all Scalambda application</strong> is: generate a Terraform module, then apply the Terraform module.</p>

<h2 id="an-opinionated-deployment-process">An Opinionated Deployment Process</h2>

<p>In this section, <strong>we’re going to show you what we (at Carpe Data) do with the Terraform</strong>, just so you can get an idea of how it might be used before you brainstorm for yourself how it best fits your workflow.</p>

<p>First, some prerequisites. Make sure you’ve done the following:</p>
<ul>
  <li><a href="https://www.scala-sbt.org/1.x/docs/Setup.html">Install</a> sbt</li>
  <li><a href="https://learn.hashicorp.com/terraform/getting-started/install.html">Install</a> Terraform</li>
  <li><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html">Install</a> AWS CLI (Optional)</li>
</ul>

<h3 id="step-1-configure-terraform">Step 1) Configure Terraform</h3>

<p>Let’s create a <code class="language-plaintext highlighter-rouge">main.tf</code> file that references the generated terraform, using it as a <a href="https://www.terraform.io/docs/configuration/modules.html">module</a>. This is what we’ll use to set up the <a href="https://www.terraform.io/docs/configuration/providers.html">provider</a> (and maybe a <a href="https://www.terraform.io/docs/backends/index.html">backend</a>?), which will allow us to communicate with the AWS API, and track our infrastructure’s state.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This block of terraform is a backend. It's totally optional, but highly recommended!</span>
<span class="c1">#</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="c1"># the region you'd like to store the state files in (not necessarily where your infrastructure will be provisioned)</span>
    <span class="nx">region</span>               <span class="p">=</span> <span class="s2">"us-west-2"</span>
    <span class="c1"># replace the value with the name of an S3 Bucket</span>
    <span class="nx">bucket</span>               <span class="p">=</span> <span class="s2">"&lt;name of S3 bucket you'd like to place the state in&gt;"</span>
    <span class="c1"># replace these two values with your project's name</span>
    <span class="nx">workspace_key_prefix</span> <span class="p">=</span> <span class="s2">"&lt;your-project-name&gt;"</span>
    <span class="nx">key</span>                  <span class="p">=</span> <span class="s2">"&lt;your-project-name&gt;.tfstate"</span>

    <span class="nx">encrypt</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># This block is the provider. It will be used by Scalambda to provision your infrastructure (i.e. the Lambda Functions)  </span>
<span class="c1"># for you. </span>
<span class="c1">#</span>
<span class="c1"># Disclaimer: It will pull AWS credentials from whatever machine you run this terraform, so if you've setup the AWS CLI,</span>
<span class="c1"># you don't have to worry about providing it credentials or anything.</span>
<span class="c1"># </span>
<span class="nx">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="c1"># This will be the region that your infrastructure is provisioned in. Replace it with your desired region if you want!</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"us-west-2"</span>
<span class="p">}</span>

<span class="c1"># This will be what connects the two resources above to the Terraform you generated in step 1.</span>
<span class="c1">#</span>
<span class="c1"># Note: You can name this module whatever you would like! Just replace "my_lambda_functions" with whatever you'd like. </span>
<span class="c1">#</span>
<span class="nx">module</span> <span class="s2">"my_lambda_functions"</span> <span class="p">{</span>
  <span class="c1"># This should be the relative path to the terraform generated by Scalambda.</span>
  <span class="c1">#</span>
  <span class="c1"># In this example, this main.tf file will just be in the root of our project, so it will be in the same directory as </span>
  <span class="c1"># our project's `src` and `target` folders. Which makes this source path really easy.</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./target/terraform"</span>

  <span class="c1"># Based on how you configured your Lambda Functions in your build.sbt file, you may or may not need to provide some</span>
  <span class="c1"># inputs to this module. You can do that now if you already know what you need, or you can wait for Terraform to show</span>
  <span class="c1"># you what it needs via some nice error messages during the init/apply step (which is what's next on this guide).</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>If you’re at all confused</strong>: You can generate a project with our <a href="https://github.com/carpe/scalambda.g8/">Giter8 Template</a>, or just check out at <a href="https://github.com/carpe/scalambda.g8/tree/master/src/main/g8">the files here</a> to get an idea of what the layout looks like.</p>

<h3 id="step-2-apply-the-terraform">Step 2) Apply the Terraform</h3>

<p>Now all that’s left to do is initialize and apply the Terraform. From the same directory as your <code class="language-plaintext highlighter-rouge">main.tf</code> file, run the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Initialize the Terraform</span>
terraform init

<span class="c"># Apply the Terraform</span>
terraform apply
</code></pre></div></div>

<p>It’s likely that after running <code class="language-plaintext highlighter-rouge">terraform init</code> or <code class="language-plaintext highlighter-rouge">terraform apply</code>, you will see some errors, don’t worry! We’re super close to being done anyway, and the errors should be fairly easy to fix. Check out the section below if you need help, or consider <a href="https://github.com/carpe/scalambda/issues/new/choose">opening an issue</a> on our Github repository.</p>

<h3 id="step-3-done">Step 3) Done!</h3>

<p>After you’ve fixed the errors and your Terraform has been applied, you should be able to see your newly provisioned Lambda Functions in the AWS Web Console. <strong>For subsequent deploys</strong>, all you need to do is run the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Use Scalambda to generate the Terraform, which will</span>
<span class="c"># recompile your code to get the latest changes</span>
sbt scalambdaTerraform

<span class="c"># Apply the newly generated Terraform.</span>
terraform apply
</code></pre></div></div>

<p>Since Terraform manages your infrastructure’s state and performs incremental changes, this will be MUCH faster than the first deploy! Which means you can quickly and iteratively make changes to your code and test them out on AWS Lambda itself if you’d like.</p>

<h3 id="common-problemssolutions">Common Problems/Solutions</h3>

<p><strong>Problem:</strong> Terraform is complaining about missing variables for the module we created <br />
<strong>Solution:</strong> Fill those missing variables in! You can find some sensible defaults for stuff like your function’s role over on the <a href="https://github.com/carpe/scalambda.g8/">Giter8 Template</a>.</p>

<p><strong>Problem:</strong> Terraform is complaining about missing AWS credentials <br />
<strong>Solution:</strong> If you have the aws cli installed, try running something simple like <code class="language-plaintext highlighter-rouge">aws s3 ls</code> to make sure your credentials are valid. If not, go ahead and <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html">install the aws cli</a> as that will allow you to run <code class="language-plaintext highlighter-rouge">aws configure</code>. From our experience, it’s both the fastest, and most effective way to solve this problem. Alternatively, you could also <a href="https://www.terraform.io/docs/providers/aws/index.html#authentication">check out the documentation</a> on managing credentials for the AWS Terraform Provider.</p>

</section></div></div></div></div><script src="/scalambda/highlight/highlight.pack.js"></script><script src="/scalambda/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/scalambda/js/search.js"></script><script src="/scalambda/js/docs.js"></script></body></html>